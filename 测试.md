### 一、性能测试基础	

#### 1.1、性能测试概述

- ##### 评估系统能力，关注时间和资源

- ##### 评估系统能力、寻找性能瓶颈、预测未来性能

  注意事项：
  	a、尽早进行测试，越早越能够发现问题
  	b、性能测试需要团队支持，性能优化需要开发、运维部门相关部门支持
  	c、测试需要独立的测试环境，测试需要独立的网络和硬件环境，保证被测系统是独立可控的，甚至需要专门的管理员和流程对测试环境进行控制
  	d、测试前确定的测试目标，测试脚本执行成本较高，为保证测试执行有效性，在测试前确定测试目标

#### 1.2、性能测试分类

##### 1.2.1、基准测试

​	a、模拟单一用户请求一种或者多种业务，产出基准性能数据

​	b、为多用户并发测试和综合场景测试等性能分析提供参考依据

##### 1.2.2、并发测试

- ​	通过模拟用户并发访问，测试多用户同时访问同一应用、模块或数据，观察系统是否存在问题

##### 1.2.3、负载测试

- 对被测系统不断加压，直到超过预定的指标或者资源达到了饱和状态不能加压为止

##### 1.2.4、压力测试

- 系统已经达到一定饱和状态，例如CPU、磁盘等处于饱和状态，此时系统能够处理业务的能力，系统是否会出现出错

##### 1.2.5、稳定性测试

- 又称可靠性测试，在系统加载一定业务压力的情况下，使系统运行一段时间7*24th，以此检测系统是否稳定

##### 1.2.6 配置测试

- 配置测试通过对被测系统的软硬件环境的调整，了解不同配置对系统的性能影响的程度，从而找到系统各项资源的最优配置

#### 1.3 性能测试的指标

##### 1.3.1 系统指标

- 响应时间

  定义：从用户发送一个请求到用户接收到服务器返回的响应数据这段时间就是响应时间

##### 1.3.2 并发数

- 并发用户数

  某物理时刻同时向系统提交请求的用户数

- 在线用户数

  某段时间内访问系统的用户数，这些用户并不一定同时向系统提交请求

- 系统用户数

  系统注册用户总数

- 三者之间联系

  系统用户数>=在线用户数>=并发用户数

##### 1.3.3 TSP

- 定义

  Transactions Per Second，意思是每秒事务数，单位时间内系统处理的客户端请求的事物次数，每个事物包含3个过程：

  a、向服务器发请求

  b、服务器处理请求

  c、服务器返回结果给客户端

- 计算方法

  tsp= 并发数/平均响应时间

##### 1.3.4 资源利用率

- 定义

  对不同系统资源的使用程度，通常以占用最大的百分比来衡量

- 服务器资源指标

  - CPU使用率

    长时间情况下，一般可接受上限85%

  - 内存利用率

    一般至少10%可用内存，内存使用率可接受上限85%

  - 磁盘IO

    一般使用%Disk Time（磁盘用于读写操作所占用的时间百分比）度量磁盘读写性能

  - 网络带宽

    判断网络连接速度是否达到瓶颈，可以用改计数器的值和目前网络带宽比较，8b=1B，100Mbps=12.5M

### 二、性能测试流程

```tiki wiki
需求分析 -> 测试计划方案 -> 测试执行 -> 结果分析
```

#### 2.1 性能需求分析

```java
性能需求分析是性能测试的基础，需求分析做的好不好直接影响性能测试的结果
```

- 明确被测系统

  - 系统架构

  - 系统要求

    - 开发语言
    - 运行环境
  
- 明确性能测试内容
  
  ```java
  电商业务 注册与登录、商品详情、搜索、支付等
  ```

- 明确性能测试策略
  
  - 基准测试
  - 压力测试
  - 负载测试
  - 稳定性测试

- 明确性能测试的指标

  - **无明确需求指标**
  
    1. 需要自己挖掘或者团队一起分析
    2. 只能靠自己查找相关资料，和类似的系统对比，以及对未来流量的预估，确定性能测试需求的指标
  
  - **明确需求指标**
  
    例如：类似指标
  
    1. 对某业务并发20个用户
    2. 平均响应时间小于等于3s
    3. 事务成功率为100%
    4. CPU使用率小于等于85%
  
    只需要根据执行分析结果与预期指标对比，如果有不满足的，就需要分析问题所在
  
  - **确定性能指标**
  
    - 响应时间
  
    - 并发数
  
    - TPS
  
      1. 根据28定律：80%的用户请求，集中在20%的热点数据或者时间段
  
         案例1：客单价200-500，以300计算，某电商要求每天完成交易额2亿
  
         **分析**：
  
         - 采用28定律，以24小时计算
  
         - 每天交易数 = 1亿 / 300
  
         - 每小时交易数 = 每天交易数 * 0.8 / (24 * 0.2)  = 111111.1111  
  
           注释：80%的请求集中在20%的热点时间段上
  
         **结果**：
  
         - TPS = 111111 / 3600 秒 = 30.86
  
      2. 资源利用率
  
         软件检测工具
  
 #### 2.2 性能测试计划及方案

目标：了解性能测试计划和方案的编写

##### 2.2.1 测试计划

- 测试目标

  确定此次性能测试的目的

  - 登录
  - 支付

- 人类资源

  - 明确性能测试的时间，计划需要多少人进行测试

- 时间进度

  | 性能测试       | 工作日 | 开始时间 | 结束时间 |
  | -------------- | ------ | -------- | -------- |
  | 测试用例设计   |        |          |          |
  | 测试环境搭建   |        |          |          |
  | 测试数据准备   |        |          |          |
  | 脚本开发及执行 |        |          |          |
  | 测试结果分析   |        |          |          |

- 风险

  - 列出可能出现的问题

##### 2.2.2 测试方案

- 测试环境

  - 架构设计

  - 软硬件配置

    注意：尽量和生产环境一致

    - 服务器
    - 数据库

  - 性能测试工具

    - LoadRounner
    - Jmeter

  - 监控工具

    - Linux
      - nmon	分析Linux性能的免费工具
      - rpc   安装在LInux，结合loadrunner使用
      - jvisualVm  主要监控java程序，监控内存等
      - Spotlight  监控数据库相关的信息
    - Windows
      - Spotlight  监控数据库相关的信息
      - perfmon.exe  性能监视器，windows自带的监控工具
  
- 测试策略

  满足在规定的服务器资源性能指标范围内，模拟不同用户数量的性能测试，确定系统能够承受的最大并发数。

  - 一般的性能测试
    - 单一场景
      - 登录
      - 下单
    - 混合场景
      - 登录->查看商品->下单
  - 稳定性测试
    - 混合业务场景下，在负载测试的并发数下，延长测试时常到3*24小时，考察系统的稳定性

#### 2.3 性能测试用例设计及执行

目标：了解性能测试用例的设计与执行

##### 2.3.1 性能测试用例设计

**按照场景设计分类**

- 预期性能测试的指标
- 单业务并发性能的测试
- 混合场景并发性能测试

**测试用例设计**

- 测试性能点

  - 登录
  - 注册

- 用例的编写

  - 预期性能指标用例

    | 用例编号 | 用例目的                                    | 测试数据 |
    | -------- | ------------------------------------------- | -------- |
    | 登录-001 | 测试100个虚拟用户并发时，系统登录的响应时间 | 3000     |

    | 操作步骤            | 期望的性能 |
    | ------------------- | ---------- |
    | 1、打开浏览器       |            |
    | 2、输入网址         |            |
    | 3、输入用户名、密码 | <1s        |
    | 4、点击login登录    |            |
    | 5、点击sign off退出 |            |
    | 6、关闭浏览器       |            |

  - 单业务并发性能测试

    | 功能 |            登录系统            |
    | ---- | :----------------------------: |
    | 目的 | 测试多人同时登录系统的性能情况 |
    | 方法 |                                |

    并发数与事务执行情况

    | 并发数 | 事务平均响应时间 | 事务最大响应时间 | 平均每秒处理事务数 | 事务成功率 |
    | ------ | ---------------- | ---------------- | ------------------ | ---------- |
    | 20     |                  |                  |                    |            |
    | 30     |                  |                  |                    |            |
    | 40     |                  |                  |                    |            |
    | 50     |                  |                  |                    |            |
    | 100    |                  |                  |                    |            |

  - 混合场景并发性能测试

    | 功能 | 100人同时操作:5人注册，30人登录，50人订票，15人取消订单 |
    | ---- | :-----------------------------------------------------: |
    | 目的 |         测试100人同时对系统操作，系统的性能情况         |

    并发数与事务执行情况

    | 并发数                                    | 事务平均响应时间 | 事务最大响应时间 | 平均每秒处理事务 | 事务成功率 |
    | ----------------------------------------- | ---------------- | ---------------- | ---------------- | ---------- |
    | 5人注册，30人登录，50人订票，15人取消订单 |                  |                  |                  |            |

    登录、注册、订票、取消订单 整合到表格中每个空格

#####  2.3.2 性能测试用例执行

- 脚本编写

  根据测试用例设计编写对应的脚本

- 场景监控设计

  把编写好的脚本去设计执行

- 运行场景

- 监控场景

- 测试报告

  - 压测结果  通过表格方式描述结果是否满足要求

  - 监控图

    包括性能指标的结果及图形

    - TPS
    - 响应时间

  - 性能评估

    根据结果进行性能分析及评估，提供可优化的方案

### 三、LoadRunner工具的使用

目标：LoadRunner环境搭建及功能介绍

#### 1.1 LoadRunner的安装和破解

目标：安装LoadRunner

#### 1.2 LoadRunner基本组成

```java
LoadRunner有4部分组成：Virtual user generator、Controller、Load Generator、Analysis
```

- 用户脚本（Virtual user generator）
  - 简称VuGen
  - 录制与编写脚本的地方，通过录制或者编写脚本模拟用户的行为也可以理解为用户行为的编辑器，同时会打印出日志信息，方便调试脚本
  - 它是个集成开发调试环境，在这里完成脚本开发并调试通过后可以放到Controller中创建场景
- 控制台（Controller）
  - 性能测试场景设计以及监控的地方，设计场景
  - Controller本身无法形成负载，它只是一个设计工具
- 压力生产器（Load Generator）
  - 负责将VuGen脚本复制成大量虚拟用户对系统产生负载
  - 由于生成的负载一般数量较大，通过一台Controller调用多台Load Generator
- 结果分析器（Analysis）
  - 收集测试数据后生成图表报告的地方，帮助我们分析数据并产生图片，方便对负载生成后的相关数据进行整理分析

##### 1.2.2 LoadRunner自带测试环境

- 启动系统自带的程序：

  ```java
  开始->HP LOadRunner->Samples->Web, 点击Start Web Server, 启动服务
  ```

  

  

​    

​    

​    

​    









































